<?php 	//********************	//** WEB MIRACLE TECHNOLOGIES	//********************		// get post		$appTable = $_POST['appTable'];		$item_id = $_POST['item_id'];		$cardUpd = array(					'name'			=> $_POST['name'],					'sub_name'			=> $_POST['sub_name'],					'short_desc'			=> $_POST['short_desc'],					'alias'			=> $_POST['alias'],					'properties'			=> $_POST['properties'],					'house_flat_col_caption'			=> $_POST['house_flat_col_caption'],					'house_flat_info'			=> $_POST['house_flat_info'],					'progress'			=> (int)$_POST['progress'],					'finish'			=> $_POST['finish'],					'mid_flats_area'			=> $_POST['mid_flats_area'],					'mid_flats_price'			=> $_POST['mid_flats_price'],					'block'			=> $_POST['block'][0],					'meta_title'			=> $_POST['meta_title'],					'meta_keys'			=> $_POST['meta_keys'],					'meta_desc'			=> $_POST['meta_desc'],					'order_id'			=> (int)$_POST['order_id'],					'modified' => date('Y-m-d H:i:s', time())					);	// File upload filename	$file_path = "../../../../split/files/house_slides/";	$filename = "images";		if(isset($_FILES[$filename]) && count($_FILES[$filename]) > 0)	{				$files_upload = $ah->mtvc_add_files_file_miltiple(array(				'path'			=>$file_path,				'name'			=>5,				'pre'			=>"hsld_",				'size'			=>10,				'rule'			=>0,				'max_w'			=>2500,				'max_h'			=>2500,				'files'			=>$filename,				'resize_path'	=>$file_path."crop/",				'resize_w'		=>500,				'resize_h'		=>350,				'resize_path_2'	=>"0",				'resize_w_2'	=>0,				'resize_h_2'	=>0			  ));		if($files_upload){			$now = date("Y-m-d H:i:s");			foreach($files_upload as $file_upload){				$query = "INSERT INTO `osc_sys_house_slides` (`source`, `house_id`, `created`, `modified`, `type`) VALUES ('$file_upload', '$item_id', '$now', '$now', 1)";				$ah->rs($query);				chmod($file_path.$file_upload,0777);			}		}	}	$file_path = "../../../../split/files/house_gal/";	$filename = "gal";		if(isset($_FILES[$filename]) && count($_FILES[$filename]) > 0)	{				$files_upload = $ah->mtvc_add_files_file_miltiple(array(				'path'			=>$file_path,				'name'			=>5,				'pre'			=>"hgal_",				'size'			=>10,				'rule'			=>0,				'max_w'			=>2500,				'max_h'			=>2500,				'files'			=>$filename,				'resize_path'	=>$file_path."crop/",				'resize_w'		=>500,				'resize_h'		=>350,				'resize_path_2'	=>"0",				'resize_w_2'	=>0,				'resize_h_2'	=>0			  ));		if($files_upload){			$now = date("Y-m-d H:i:s");			foreach($files_upload as $file_upload){				$query = "INSERT INTO `osc_sys_house_gal` (`source`, `house_id`, `created`, `modified`, `type`, `orientation`) VALUES ('$file_upload', '$item_id', '$now', '$now', 1, 0)";				$ah->rs($query);				chmod($file_path.$file_upload,0777);			}		}	}	if (isset($_POST['video']) && $_POST['video']) {		$q = "SELECT M.id FROM `osc_sys_house_slides` AS M WHERE M.type = 2 AND M.house_id = '$item_id' LIMIT 1";		$check = $ah->rs($q);		$video = $_POST['video'];		if ($check) {			$check_id = (int)$check[0]["id"];			$q = "UPDATE `osc_sys_house_slides` SET `source` = '$video' WHERE `id` = '$check_id' LIMIT 1";			$ah->rs($q);		}else{			$now = date("Y-m-d H:i:s");			$q = "INSERT INTO `osc_sys_house_slides` (`house_id`, `source`, `type`, `created`, `modified`) VALUES ('$item_id', '$video', '2', '$now', '$now')";			$ah->rs($q);		}	}elseif($_POST['video'] == ""){		$q = "DELETE FROM osc_sys_house_slides WHERE `type` = 2 AND `house_id` = '$item_id'";			$ah->rs($q);	}	if (isset($_POST['panorama']) && $_POST['panorama']) {		$q = "SELECT M.id FROM `osc_sys_house_slides` AS M WHERE M.type = 3 AND M.house_id = '$item_id' LIMIT 1";		$check = $ah->rs($q);		$panorama = $_POST['panorama'];		if ($check) {			$check_id = (int)$check[0]["id"];			$q = "UPDATE `osc_sys_house_slides` SET `source` = '$panorama' WHERE `id` = '$check_id' LIMIT 1";			$ah->rs($q);		}else{			$now = date("Y-m-d H:i:s");			$q = "INSERT INTO `osc_sys_house_slides` (`house_id`, `source`, `type`, `created`, `modified`) VALUES ('$item_id', '$panorama', '3', '$now', '$now')";			$ah->rs($q);		}	}elseif($_POST['panorama'] == ""){		$q = "DELETE FROM osc_sys_house_slides WHERE `type` = 3 AND `house_id` = '$item_id'";		$ah->rs($q);	}							// Update main table		$alias =$_POST["alias"]; 	if ($alias) {		$q = "SELECT M.id FROM `osc_sys_houses` AS M WHERE M.alias = '$alias' AND M.id != '$item_id' LIMIT 1";		$check_alias = $ah->rs($q,1);		if (!$check_alias) {			if ($_POST["finish"]) {				$query = "UPDATE [pre]$appTable SET ";					$cntUpd = 0;				foreach($cardUpd as $field => $itemUpd)				{					$cntUpd++;					$query .= ($cntUpd==1 ? "`$field`='$itemUpd'" : ", `$field`='$itemUpd'");				}								$query .= " WHERE `id`=$item_id LIMIT 1";										$ah->rs($query);												$data['status'] = "success";				$data['message'] = "Дом успешно сохранен.";			}else{				$data["message"] = "Укажите дату сдачи дома.";			}		}else{			$data["message"] = "Такой Алиас уже существует";		}	}else{		$data["message"] = "Заполните поле `Алиас`.";	}		