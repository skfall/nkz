<?php 	//********************	//** WEB MIRACLE TECHNOLOGIES	//********************		// get post	$event_type = (isset($_POST['type']) && $_POST['type'] ? $_POST['type'] : 0);	if ($event_type == 0) exit("Internal error. Please contact to developer.");		$item_id = 0;	$appTable = $_POST['appTable'];	switch ($event_type) {		case '3':			$cardUpd = flatLayoutEvent();			break;			case '4':			$cardUpd = cottageLayoutEvent();			break;		case '5':			$cardUpd = townhousesTimerLayoutEvent();			break;		case '6':			$cardUpd = townhousesBlockEvent();			break;		case '2':			$cardUpd = flatsRoomEvent();			break;			default:			break;	}	function flatLayoutEvent(){		return array(			'type'			=> $_POST['type'],			'name'			=> $_POST['name'],			'block'			=> $_POST['block'][0],			'timer_date'	=> $_POST['timer_date']		);	}	function cottageLayoutEvent(){		return array(			'type'			=> $_POST['type'],			'name'			=> $_POST['name'],			'block'			=> $_POST['block'][0],			'details'		=> $_POST['details']		);	}	function townhousesTimerLayoutEvent(){		return array(			'type'			=> $_POST['type'],			'name'			=> $_POST['name'],			'old_price'		=> (double)$_POST['old_price'],			'curr_price'	=> (double)$_POST['curr_price'],			'block'			=> $_POST['block'][0],			'timer_date'	=> $_POST['timer_date'],			'details'		=> $_POST['details']		);	}	function townhousesBlockEvent(){		return array(			'type'			=> $_POST['type'],			'name'			=> $_POST['name'],			'caption'		=> $_POST['caption'],			'details'		=> $_POST['details'],			'old_price'		=> (double)$_POST['old_price'],			'curr_price'	=> (double)$_POST['curr_price'],			'block'			=> $_POST['block'][0],			'benefits'		=> (mb_strlen($_POST['benefits']) > 0 ? serialize($_POST['benefits']) : '')		);	}	function flatsRoomEvent(){		return array(			'type'			=> $_POST['type'],			'name'			=> $_POST['name'],			'block'			=> $_POST['block'][0]		);	}	// File upload filename	$file_path = "../../../../split/files/events/";	// PREVIEW ------------------	$im_1_filename = "room_banner";	$im_1 		= false;	$im_1_name 	= 5;	$im_1_pre 	= "ev_";		if(isset($_FILES[$im_1_filename]) && $_FILES[$im_1_filename]['size'] > 0){		$im_1 = true;	}	if($im_1){		$file_update = false;		$file_update = $ah->mtvc_add_files_file(array(				'path'			=>$file_path,				'name'			=>$im_1_name,				'pre'			=>$im_1_pre,				'size'			=>10,				'rule'			=>0,				'max_w'			=>2500,				'max_h'			=>2500,				'files'			=>$im_1_filename			  ));		if($file_update){			$cardUpd[$im_1_filename] = $file_update;		}	}		// Create main table item		$query = "INSERT INTO [pre]$appTable ";	$fieldsStr = " ( ";	$valuesStr = " ( ";	$cntUpd = 0;	foreach($cardUpd as $field => $itemUpd){		$cntUpd++;				$fieldsStr .= ($cntUpd==1 ? "`$field`" : ", `$field`");				$valuesStr .= ($cntUpd==1 ? "'$itemUpd'" : ", '$itemUpd'");	}		$fieldsStr .= " ) ";	$valuesStr .= " ) ";	$query .= $fieldsStr." VALUES ".$valuesStr;	$item_id = $ah->rs($query,0,1,1);	if($item_id){		$data['item_id'] = $item_id;	}else{		$data['item_id'] = 0;	}	$data['real_item_id'] = $item_id;	$layouts_id = (isset($_POST['layout_id']) && $_POST['layout_id'] ? $_POST['layout_id'] : array());	$layout_table = "";	switch ($event_type) {		case '3':			$layout_table = "osc_sys_flats_area";			break;			case '4':			$layout_table = "osc_sys_cottages_layouts";			break;		case '5':			$layout_table = "osc_sys_townhouses_layouts";			break;		case '6':			$layout_table = "osc_sys_townhouses";			break;		case '2':			$layout_table = "osc_sys_flats_rooms";			break;			default:			break;	}	if ($layouts_id) {		foreach ($layouts_id as $key => $value) {			$q = "UPDATE `".$layout_table."` SET `event_id` = '$item_id' WHERE `id` = '$value'";			$ah->rs($q,0,1);		}	}	/*IMG GALLERY SET*/	$file_path = "../../../../split/files/events/";	$filename = "event_slider";	if(isset($_FILES[$filename]) && count($_FILES[$filename]) > 0 && $item_id){				$files_upload = $ah->mtvc_add_files_file_miltiple(array(				'path'			=>$file_path,				'name'			=>5,				'pre'			=>"evi_",				'size'			=>10,				'rule'			=>0,				'max_w'			=>2500,				'max_h'			=>2500,				'files'			=>$filename,				'resize_path'	=>$file_path			  ));		if($files_upload){			foreach($files_upload as $file_upload){				$query = "INSERT INTO osc_sys_event_items (`ref`, `file`) VALUES ('$item_id', '$file_upload')";				$ah->rs($query,0,1);				chmod($file_path.$file_upload,0777);			}		}	}		$data['message'] = "Акция успешно создана. ID =  $item_id";	$data['status'] = "success";	